<?xml version="1.0" encoding="UTF-8"?>
<!-- 
    | Licensed to Jasig under one or more contributor license
    | agreements. See the NOTICE file distributed with this work
    | for additional information regarding copyright ownership.
    | Jasig licenses this file to you under the Apache License,
    | Version 2.0 (the "License"); you may not use this file
    | except in compliance with the License. You may obtain a
    | copy of the License at:
    |  
    | http://www.apache.org/licenses/LICENSE-2.0
    |  
    | Unless required by applicable law or agreed to in writing,
    | software distributed under the License is distributed on
    | an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    | KIND, either express or implied. See the License for the
    | specific language governing permissions and limitations
    | under the License.   
    |-->
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
    xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context-2.5.xsd">
    
    <bean id="propertyConfigurer"
        class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer" lazy-init="false">
        <property name="locations">
            <list>
                <value>classpath:configuration.properties</value>
            </list>
        </property>
    </bean>  
    
    <!-- Controllers -->
    
    <bean id="abstractController" abstract="true">
        <property name="announcementService">
            <ref bean="announcementService"/>
        </property>
    </bean>
    
    <bean id="baseAdminController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.BaseAdminController"/>
    
    <bean id="showTopicController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.ShowTopicController">
        <property name="includeJQuery"><value>${javascript.jQuery.include}</value></property>
    </bean>
    
    <bean id="deleteTopicController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.DeleteTopicController"/>
    
    <bean id="approveAnnouncementController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.ApproveAnnouncementController">
    </bean>
    
    <bean id="deleteAnnouncementController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.DeleteAnnouncementController"/>
 
    <bean id="addUserController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.AddUserController"/>    
    
    <bean id="deleteUserController" parent="abstractController"
        class="org.jasig.portlet.announcements.controller.DeleteUserController"/>    
       
    <bean id="addTopicFormController" parent="abstractController" 
        class="org.jasig.portlet.announcements.controller.AddTopicFormController">
        <property name="commandClass" value="org.jasig.portlet.announcements.model.Topic"/>
        <property name="commandName" value="topic"/>
        <property name="formView" value="addTopic"/>
        <property name="successView" value="baseAdmin"/>
        <property name="validator" ref="addTopicValidator"/>
    </bean>
    
    <bean id="addMembersFormController" parent="abstractController" 
        class="org.jasig.portlet.announcements.controller.AddMembersFormController">
        <property name="groupService">
            <ref bean="groupService"/>
        </property>
        <property name="commandClass" value="org.jasig.portlet.announcements.model.RoleSelection"/>
        <property name="commandName" value="selection"/>
        <property name="formView" value="addMembers"/>
        <property name="successView" value="addTopic"/>
    </bean>
    
    <bean id="addAnnouncementFormController" parent="abstractController" 
        class="org.jasig.portlet.announcements.controller.AddAnnouncementFormController">
        <property name="commandClass" value="org.jasig.portlet.announcements.model.Announcement"/>
        <property name="commandName" value="announcement"/>
        <property name="formView" value="addAnnouncement"/>
        <property name="successView" value="showTopic"/>
        <property name="validator" ref="addAnnouncementValidator"/>
        <property name="customDateFormat"><value>${dateformat.input.default}</value></property>
    </bean>
    
    <!-- Validators -->
    
    <bean id="addTopicValidator" class="org.jasig.portlet.announcements.model.validators.TopicValidator"/>
    <bean id="addAnnouncementValidator" class="org.jasig.portlet.announcements.model.validators.AnnouncementValidator"/>
        
    <!-- Portlet Mode handling -->
       
    <bean id="parameterMappingInterceptor" class="org.springframework.web.portlet.handler.ParameterMappingInterceptor"/>
    
    <bean id="portletModeParameterHandlerMapping" class="org.springframework.web.portlet.handler.PortletModeParameterHandlerMapping">
        <property name="order" value="10"/>
        <property name="interceptors">
            <list>
                <ref bean="parameterMappingInterceptor"/>
                <ref bean="openSessionInViewInterceptor"/>
            </list>
        </property>
        <property name="portletModeParameterMap">
            <map>
                <entry key="view">
                    <map>
                        <entry key="baseAdmin" value-ref="baseAdminController"/>
                        <entry key="addTopic" value-ref="addTopicFormController"/>
                        <entry key="deleteTopic" value-ref="deleteTopicController"/>
                        <entry key="showTopic" value-ref="showTopicController"/>
                        <entry key="addMembers" value-ref="addMembersFormController"/>
                        <entry key="addUser" value-ref="addUserController"/>            
                        <entry key="deleteUser" value-ref="deleteUserController"/>              
                        <entry key="addAnnouncement" value-ref="addAnnouncementFormController"/>
                        <entry key="deleteAnnouncement" value-ref="deleteAnnouncementController"/>
                        <entry key="approveAnnouncement" value-ref="approveAnnouncementController"/>
                    </map>
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="portletModeHandlerMapping" class="org.springframework.web.portlet.handler.PortletModeHandlerMapping">
        <property name="order" value="20"/>
        <property name="interceptors">
            <list>
                <ref bean="openSessionInViewInterceptor"/>
            </list>
        </property>
        <property name="portletModeMap">
            <map>
                <entry key="view" value-ref="baseAdminController"/>
            </map>
        </property>
    </bean>
    
    <bean id="exceptionHandler" parent="defaultExceptionHandlerTemplate"/>
    
</beans>